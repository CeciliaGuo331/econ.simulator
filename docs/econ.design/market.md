# 市场设计

## **1. 引言与设计哲学**

**1.1. 文档目标:**
本文档旨在详细定义**第二层：市场与环境层 (Market & Environment Layer)** 的具体实现。它将明确市场中流动的数据类型、数据的可见性规则，以及三大核心市场（商品、劳动、金融）的运行机制。本文档是 `STRUCTURE.md` 和 `AGENT.md` 的直接下游设计。

**1.2. 核心设计假设:**
* **非对称市场结构:** 本市场的核心特征是“多对一”或“一对多”的交互。
    * **`~400` 个个人/家户代理人**，行为具有异质性。
    * **`1` 个代表性企业代理人** (垄断生产者)。
    * **`1` 个代表性商业银行代理人** (垄断金融中介)。
    * **`1` 个央行代理人**和 **`1` 个政府代理人**。
* **时序性:** 所有市场机制均在 `STRUCTURE.md` 定义的**每日事件循环**的 **Tick 2 (交易与交互阶段)** 中执行。

---

## **2. 市场数据架构**

为了支持代理人的决策和系统的可观测性，数据被划分为不同的可见性层级。

**2.1. 数据可见性层级:**

* **层级 0: 私有数据 (Private Data / `agent_state`)**
    * **描述:** 每个代理人只能访问其自身的内部状态。这是其决策的最直接依据。
    * **示例:** 个人的确切现金数额、企业的具体库存量、银行的详细资产负债表。

* **层级 1: 公开市场数据 (Public Market Data / `market_data`)**
    * **描述:** 所有代理人都可以访问的、经过汇总和匿名的宏观/市场信息。这是代理人感知外部环境的窗口。
    * **示例:** 商品的公开售价、市场的平均工资水平、基准利率、GDP、通货膨胀率。

* **层级 2: 系统/管理员数据 (System/Admin Data)**
    * **描述:** 引擎拥有的“上帝视角”全量数据。用于引擎的内部计算、数据记录以及外部观察者的分析与可视化。
    * **示例:** 每个人的每一笔交易记录、所有代理人的私有状态快照、市场订单簿的完整详情。

**2.2. 数据清单 (Data Manifest):**

| 数据项 (Data Item)               | 所属市场       | 可见性层级        | 描述                                     |
| -------------------------------- | -------------- | ----------------- | ---------------------------------------- |
| **商品与价格** |                |                   |                                          |
| 商品种类列表与公开售价           | 商品市场       | **层级 1 (公开)** | 企业为每种商品设定的当前售价。           |
| 总需求/总供给估算                | 商品市场       | **层级 1 (公开)** | 上一周期市场商品的总需求与总供给量。     |
| **工资与就业** |                |                   |                                          |
| 各类职位的空缺数量与薪资         | 劳动力市场     | **层级 1 (公开)** | 企业/政府发布的招聘信息。                |
| 宏观失业率                       | 宏观数据中心   | **层级 1 (公开)** | 整个经济体的失业率。                     |
| 市场平均工资水平                 | 宏观数据中心   | **层级 1 (公开)** | 所有在职人员的平均工资。                 |
| **利率与金融** |                |                   |                                          |
| 商业银行存款/贷款利率            | 金融市场       | **层级 1 (公开)** | 商业银行公布的利率。                     |
| 央行基准利率/法定准备金率        | 金融市场       | **层级 1 (公开)** | 央行发布的政策。                         |
| 国债发行利率/规模                | 金融市场       | **层级 1 (公开)** | 政府发布的国债信息。                     |
| **宏观经济** |                |                   |                                          |
| GDP (国内生产总值)               | 宏观数据中心   | **层级 1 (公开)** | 最近一个周期的经济产出。                 |
| CPI (消费者价格指数) / 通胀率    | 宏观数据中心   | **层级 1 (公开)** | 物价水平及其变化率。                     |
| 基尼系数                         | 宏观数据中心   | **层级 1 (公开)** | 衡量财富或收入不平等的指标。             |
| **私有信息示例** |                |                   |                                          |
| 个人A的确切现金和存款            | 个人私有       | **层级 0 (私有)** | 只有个人A和系统可见。                    |
| 企业的确切库存和利润             | 企业私有       | **层级 0 (私有)** | 只有企业和系统可见。                     |

---

## **3. 市场运行机制 (Market Mechanisms)**

以下机制均在 **Tick 2** 中由引擎的**市场与环境层**调度执行。

**3.1. 商品市场 (Goods Market)**

* **结构:** 垄断市场 (Monopoly)。`~400`个个人作为买方，`1`个企业作为卖方。
* **运行流程:**
    1.  **价格发布 (Price Posting):**
        * **输入:** 企业的`定价策略`决策。
        * **机制:** 企业将其决定的所有商品的售价发布到市场，成为所有个人可见的**层级 1**数据。
    2.  **需求提交 (Demand Submission):**
        * **输入:** 所有个人的`消费决策`。
        * **机制:** 每个个人根据市场公布的售价和自身预算、偏好，向市场提交一份匿名的“购买清单”（Purchase Orders）。
    3.  **市场出清 (Market Clearing):**
        * **输入:** 企业的总库存，所有个人的购买清单。
        * **机制:** 引擎作为中央清算方，遍历所有购买清单。
            * **若企业库存 ≥ 总需求:** 所有交易成功。
            * **若企业库存 < 总需求 (库存耗尽):** 交易按随机顺序或预设的优先级（如满足基本需求优先）执行，直到库存售完，剩余的购买请求失败。
    4.  **结算 (Settlement):**
        * **机制:** 引擎原子性地更新交易双方的状态：减少个人的现金，增加企业的现金；减少企业的库存，（逻辑上）增加个人的“持有品”。

**3.2. 劳动力市场 (Labor Market)**

* **结构:** 双寡头垄断招聘市场 (Duopsony-like)。`~400`个个人作为劳动供给方，`1`个企业和`1`个政府作为劳动需求方。
* **运行流程:**
    1.  **岗位发布 (Job Posting):**
        * **输入:** 企业和政府的`雇佣/解雇决策`。
        * **机制:** 企业和政府向市场发布招聘岗位（Job Vacancies），明确岗位数量、要求和薪资，成为**层级 1**数据。
    2.  **求职申请 (Job Application):**
        * **输入:** 所有个人的`劳动决策`。
        * **机制:** 每个未就业或希望跳槽的个人，向其意向的岗位提交匿名的求职申请。
    3.  **匹配撮合 (Matching Algorithm):**
        * **输入:** 所有岗位及其申请人列表。
        * **机制:** 引擎对每个岗位，从其申请人池中进行选择。
            * **简化版:** 随机抽取。
            * **进阶版:** 根据申请人的`人力资本`（技能、教育水平）与岗位要求的匹配度进行择优录取。
    4.  **合约签订 (Contracting):**
        * **机制:** 匹配成功的个人与雇主（企业/政府）建立雇佣关系。引擎更新个人的就业状态和雇主的员工列表。工资将在下一个**Day**的**Tick 1**支付。

**3.3. 金融市场 (Financial Market)**

* **结构:** 垄断性金融服务。`~400`个个人和`1`个企业作为客户，`1`个商业银行作为服务提供方。政府作为债券的发行方。
* **运行流程:**
    * **A. 存贷款市场 (Deposit & Loan Market):**
        1.  **利率发布:** 商业银行根据其`定价决策`，发布存款和贷款利率，成为**层级 1**数据。
        2.  **存款处理:** 个人/企业根据其`储蓄`和`资产配置`决策，向银行存入资金。引擎直接处理记账。
        3.  **贷款申请:** 个人/企业根据其`融资决策`，向银行提交贷款申请。
        4.  **信贷审批:** 商业银行根据其`信贷审批`决策，对收到的所有申请进行评估，并返回批准/拒绝的结果。
        5.  **贷款发放:** 引擎为所有获批的贷款进行结算，增加借款人的现金和负债，并更新银行的资产负债表。
    * **B. 债券市场 (Bond Market):**
        1.  **债券发行:** 政府根据其`发行国债`决策，向市场发布新国债的规模、利率和期限，成为**层级 1**数据。
        2.  **认购提交:** 商业银行、企业和（可选的）富裕个人，根据其`资产负债管理`或`投资决策`，提交认购订单。
        3.  **分配与结算:** 引擎根据订单处理认购。若总认购额超过发行规模，可按比例分配。成功后，引擎结算资金和债权。
