# 市场设计

## **1. 引言与设计哲学**

**1.1. 文档目标:**
本文档旨在详细定义**第二层：市场与环境层 (Market & Environment Layer)** 的具体实现。它将明确市场中流动的数据类型、数据的可见性规则，以及三大核心市场（商品、劳动、金融）的运行机制。本文档是 `world_settings.md` 和 `agent.md` 的直接下游设计。

**1.2. 核心设计假设:**
* **非对称市场结构:** 本市场的核心特征是“多对一”或“一对多”的交互。
    * **`~400` 个个人/家户代理人**，行为具有异质性。
    * **`1` 个代表性企业代理人** (垄断生产者)。
    * **`1` 个代表性商业银行代理人** (垄断金融中介)。
    * **`1` 个央行代理人**和 **`1` 个政府代理人**。
* **时序性:** 所有市场机制均在 `world_settings.md` 定义的**标准事件循环 (Tick)** 的**市场交易阶段**中执行。

---

## **2. 市场数据架构**

为了支持代理人的决策和系统的可观测性，数据被划分为不同的可见性层级。

**2.1. 数据可见性层级:**

* **层级 0: 私有数据 (Private Data / `agent_state`)**
    * **描述:** 每个代理人只能访问其自身的内部状态。这是其决策的最直接依据。
    * **示例:** 个人的确切现金数额、企业的具体库存量、银行的详细资产负债表。

* **层级 1: 公开市场数据 (Public Market Data / `market_data`)**
    * **描述:** 所有代理人都可以访问的、经过汇总和匿名的宏观/市场信息。这是代理人感知外部环境的窗口。
    * **示例:** 商品的公开售价、市场的平均工资水平、基准利率、GDP、通货膨胀率。

* **层级 2: 系统/管理员数据 (System/Admin Data)**
    * **描述:** 引擎拥有的“上帝视角”全量数据。用于引擎的内部计算、数据记录以及外部观察者的分析与可视化。
    * **示例:** 每个人的每一笔交易记录、所有代理人的私有状态快照、市场订单簿的完整详情。

**2.2. 数据清单 (Data Manifest):**

| 数据项 (Data Item)               | 数据来源       | 可见性层级        | 描述                                     |
| -------------------------------- | -------------- | ----------------- | ---------------------------------------- |
| **层级 1: 公开市场数据** |                |                   |                                          |
| 商品价格表                       | 企业           | **层级 1 (公开)** | 所有商品的当前售价。                     |
| 职位空缺与薪资                   | 企业/政府      | **层级 1 (公开)** | 可申请岗位的数量和工资水平。             |
| 银行利率 (存款/贷款)             | 银行           | **层级 1 (公开)** | 当前存贷款利率。                         |
| 央行政策利率                     | 央行           | **层级 1 (公开)** | 基准利率和法定准备金率。                 |
| 国债发行信息                     | 政府           | **层级 1 (公开)** | 国债利率、规模和期限。                   |
| GDP 和通胀率                     | 系统统计       | **层级 1 (公开)** | 宏观经济核心指标。                       |
| 失业率和平均工资                 | 系统统计       | **层级 1 (公开)** | 劳动力市场主要指标。                     |
| **层级 0: 代理人私有数据** |                |                   |                                          |
| 个人财务状况                     | 个人           | **层级 0 (私有)** | 现金、存款、债务的精确数额。             |
| 个人偏好参数                     | 个人           | **层级 0 (私有)** | 消费偏好和风险偏好系数。                 |
| 个人技能等级                     | 个人           | **层级 0 (私有)** | 人力资本水平，影响就业机会。             |
| 企业库存和成本                   | 企业           | **层级 0 (私有)** | 精确库存量和生产成本结构。               |
| 企业经营策略                     | 企业           | **层级 0 (私有)** | 定价、招聘和投资决策规则。               |
| 银行资产负债表                   | 银行           | **层级 0 (私有)** | 详细的资产、负债和风险敞口。             |
| 银行信贷模型                     | 银行           | **层级 0 (私有)** | 客户信用评级和风险定价算法。             |
| 央行政策函数                     | 央行           | **层级 0 (私有)** | 货币政策调整的决策规则和目标权重。       |
| 政府预算明细                     | 政府           | **层级 0 (私有)** | 各部门收支计划和政策实施成本。           |
| **层级 2: 系统管理数据** |                |                   |                                          |
| 完整交易日志                     | 系统引擎       | **层级 2 (系统)** | 所有交易的详细记录和状态变更。           |
| 代理人状态快照                   | 系统引擎       | **层级 2 (系统)** | 全体代理人的完整私有状态镜像。           |
| 市场微观结构                     | 系统引擎       | **层级 2 (系统)** | 订单簿、匹配算法和清算详情。             |
| 系统运行监控                     | 系统引擎       | **层级 2 (系统)** | 仿真性能、资源使用和错误日志。           |

---

## **3. 市场运行机制 (Market Mechanisms)**

以下机制均在每个**标准事件循环 (Tick)** 中由引擎的**市场与环境层**调度执行。

**3.1. 商品市场 (Goods Market)**

* **结构:** 垄断市场 (Monopoly)。`~400`个个人作为买方，`1`个企业作为卖方。
* **运行流程:**
    1.  **价格发布 (Price Posting):**
        * **输入:** 企业的`定价策略`决策。
        * **机制:** 企业将其决定的所有商品的售价发布到市场，成为所有个人可见的**层级 1**数据。
    2.  **需求提交 (Demand Submission):**
        * **输入:** 所有个人的`消费决策`。
        * **机制:** 每个个人根据市场公布的售价和自身预算、偏好，向市场提交一份匿名的“购买清单”（Purchase Orders）。
    3.  **市场出清 (Market Clearing):**
        * **输入:** 企业的总库存，所有个人的购买清单。
        * **机制:** 引擎作为中央清算方，遍历所有购买清单。
            * **若企业库存 ≥ 总需求:** 所有交易成功。
            * **若企业库存 < 总需求 (库存耗尽):** 交易按随机顺序或预设的优先级（如满足基本需求优先）执行，直到库存售完，剩余的购买请求失败。
    4.  **结算 (Settlement):**
        * **机制:** 引擎原子性地更新交易双方的状态：减少个人的现金，增加企业的现金；减少企业的库存，（逻辑上）增加个人的“持有品”。

**3.2. 劳动力市场 (Labor Market)**

* **结构:** 双寡头垄断招聘市场 (Duopsony-like)。`~400`个个人作为劳动供给方，`1`个企业和`1`个政府作为劳动需求方。
* **运行流程:**
    1.  **岗位发布 (Job Posting):**
        * **输入:** 企业和政府的`雇佣/解雇决策`。
        * **机制:** 企业和政府向市场发布招聘岗位（Job Vacancies），明确岗位数量、要求和薪资，成为**层级 1**数据。
    2.  **求职申请 (Job Application):**
        * **输入:** 所有个人的`劳动决策`。
        * **机制:** 每个未就业或希望跳槽的个人，向其意向的岗位提交匿名的求职申请。
    3.  **匹配撮合 (Matching Algorithm):**
        * **输入:** 所有岗位及其申请人列表。
        * **机制:** 引擎对每个岗位，从其申请人池中进行选择。
            * **简化版:** 随机抽取。
            * **进阶版:** 根据申请人的`人力资本`（技能、教育水平）与岗位要求的匹配度进行择优录取。
    4.  **合约签订 (Contracting):**
        * **机制:** 匹配成功的个人与雇主（企业/政府）建立雇佣关系。引擎更新个人的就业状态和雇主的员工列表。工资将在下一个**Day**的**Tick 1**支付。

**3.3. 金融市场 (Financial Market)**

* **结构:** 垄断性金融服务。`~400`个个人和`1`个企业作为客户，`1`个商业银行作为服务提供方。政府作为债券的发行方。
* **运行流程:**
    * **A. 存贷款市场 (Deposit & Loan Market):**
        1.  **利率发布:** 商业银行根据其`定价决策`，发布存款和贷款利率，成为**层级 1**数据。
        2.  **存款处理:** 个人/企业根据其`储蓄`和`资产配置`决策，向银行存入资金。引擎直接处理记账。
        3.  **贷款申请:** 个人/企业根据其`融资决策`，向银行提交贷款申请。
        4.  **信贷审批:** 商业银行根据其`信贷审批`决策，对收到的所有申请进行评估，并返回批准/拒绝的结果。
        5.  **贷款发放:** 引擎为所有获批的贷款进行结算，增加借款人的现金和负债，并更新银行的资产负债表。
    * **B. 债券市场 (Bond Market):**
        1.  **债券发行:** 政府根据其`发行国债`决策，向市场发布新国债的规模、利率和期限，成为**层级 1**数据。
        2.  **认购提交:** 商业银行、企业和（可选的）富裕个人，根据其`资产负债管理`或`投资决策`，提交认购订单。
        3.  **分配与结算:** 引擎根据订单处理认购。若总认购额超过发行规模，可按比例分配。成功后，引擎结算资金和债权。
